from PyQt5 import QtCore, QtGui, QtWidgets
import os
from string import Template
import ctypes
import shutil

desktop_path = os.path.join(os.path.join(os.path.join(os.environ['USERPROFILE']), 'Desktop\\'))

class Ui_kramer_ewelon_window(object):
    def setupUi(self, kramer_ewelon_window):
        kramer_ewelon_window.setObjectName("kramer_ewelon_window")
        kramer_ewelon_window.resize(1018, 681)
        palette = QtGui.QPalette()
        brush = QtGui.QBrush(QtGui.QColor(255, 255, 255))
        brush.setStyle(QtCore.Qt.SolidPattern)
        palette.setBrush(QtGui.QPalette.Active, QtGui.QPalette.Base, brush)
        brush = QtGui.QBrush(QtGui.QColor(48, 213, 200))
        brush.setStyle(QtCore.Qt.SolidPattern)
        palette.setBrush(QtGui.QPalette.Active, QtGui.QPalette.Window, brush)
        brush = QtGui.QBrush(QtGui.QColor(255, 255, 255))
        brush.setStyle(QtCore.Qt.SolidPattern)
        palette.setBrush(QtGui.QPalette.Inactive, QtGui.QPalette.Base, brush)
        brush = QtGui.QBrush(QtGui.QColor(48, 213, 200))
        brush.setStyle(QtCore.Qt.SolidPattern)
        palette.setBrush(QtGui.QPalette.Inactive, QtGui.QPalette.Window, brush)
        brush = QtGui.QBrush(QtGui.QColor(48, 213, 200))
        brush.setStyle(QtCore.Qt.SolidPattern)
        palette.setBrush(QtGui.QPalette.Disabled, QtGui.QPalette.Base, brush)
        brush = QtGui.QBrush(QtGui.QColor(48, 213, 200))
        brush.setStyle(QtCore.Qt.SolidPattern)
        palette.setBrush(QtGui.QPalette.Disabled, QtGui.QPalette.Window, brush)
        kramer_ewelon_window.setPalette(palette)
        self.centralwidget = QtWidgets.QWidget(kramer_ewelon_window)
        self.centralwidget.setObjectName("centralwidget")
        self.welcome_label = QtWidgets.QLabel(self.centralwidget)
        self.welcome_label.setGeometry(QtCore.QRect(50, 30, 240, 41))
        font = QtGui.QFont()
        font.setFamily("Source Sans Pro Light")
        font.setPointSize(20)
        self.welcome_label.setFont(font)
        self.welcome_label.setObjectName("welcome_label")
        self.generate_button = QtWidgets.QPushButton(self.centralwidget)
        self.generate_button.setGeometry(QtCore.QRect(830, 560, 151, 51))
        self.generate_button.setObjectName("generate_button")

        self.day_label = QtWidgets.QLabel(self.centralwidget)
        self.day_label.setGeometry(QtCore.QRect(130, 250, 121, 41))
        font = QtGui.QFont()
        font.setFamily("Source Sans Pro Light")
        font.setPointSize(16)
        self.day_label.setFont(font)
        self.day_label.setObjectName("day_label")
        self.month_label = QtWidgets.QLabel(self.centralwidget)
        self.month_label.setGeometry(QtCore.QRect(130, 330, 121, 41))
        font = QtGui.QFont()
        font.setFamily("Source Sans Pro Light")
        font.setPointSize(16)
        self.month_label.setFont(font)
        self.month_label.setObjectName("month_label")
        self.harness_id_label = QtWidgets.QLabel(self.centralwidget)
        self.harness_id_label.setGeometry(QtCore.QRect(130, 170, 221, 41))
        font = QtGui.QFont()
        font.setFamily("Source Sans Pro Light")
        font.setPointSize(16)
        self.harness_id_label.setFont(font)
        self.harness_id_label.setObjectName("harness_id_label")
        self.day_entry = QtWidgets.QLineEdit(self.centralwidget)
        self.day_entry.setGeometry(QtCore.QRect(280, 250, 151, 41))
        font = QtGui.QFont()
        font.setFamily("Source Sans Pro Light")
        font.setPointSize(16)
        self.day_entry.setFont(font)
        self.day_entry.setFocusPolicy(QtCore.Qt.ClickFocus)
        self.day_entry.setAlignment(QtCore.Qt.AlignCenter)
        self.day_entry.setObjectName("day_entry")
        self.month_entry = QtWidgets.QLineEdit(self.centralwidget)
        self.month_entry.setGeometry(QtCore.QRect(280, 330, 151, 41))
        font = QtGui.QFont()
        font.setFamily("Source Sans Pro Light")
        font.setPointSize(16)
        self.month_entry.setFont(font)
        self.month_entry.setFocusPolicy(QtCore.Qt.ClickFocus)
        self.month_entry.setText("")
        self.month_entry.setAlignment(QtCore.Qt.AlignCenter)
        self.month_entry.setObjectName("month_entry")
        self.harness_id_entry = QtWidgets.QLineEdit(self.centralwidget)
        self.harness_id_entry.setGeometry(QtCore.QRect(350, 170, 521, 41))
        font = QtGui.QFont()
        font.setFamily("Source Sans Pro Light")
        font.setPointSize(16)
        self.harness_id_entry.setFont(font)
        self.harness_id_entry.setCursor(QtGui.QCursor(QtCore.Qt.IBeamCursor))
        self.harness_id_entry.setFocusPolicy(QtCore.Qt.ClickFocus)
        self.harness_id_entry.setText("")
        self.harness_id_entry.setAlignment(QtCore.Qt.AlignCenter)
        self.harness_id_entry.setClearButtonEnabled(False)
        self.harness_id_entry.setObjectName("harness_id_entry")
        self.year_entry = QtWidgets.QLineEdit(self.centralwidget)
        self.year_entry.setGeometry(QtCore.QRect(280, 410, 151, 41))
        font = QtGui.QFont()
        font.setFamily("Source Sans Pro Light")
        font.setPointSize(16)
        self.year_entry.setFont(font)
        self.year_entry.setFocusPolicy(QtCore.Qt.ClickFocus)
        self.year_entry.setAlignment(QtCore.Qt.AlignCenter)
        self.year_entry.setObjectName("year_entry")
        self.year_label = QtWidgets.QLabel(self.centralwidget)
        self.year_label.setGeometry(QtCore.QRect(130, 410, 121, 41))
        font = QtGui.QFont()
        font.setFamily("Source Sans Pro Light")
        font.setPointSize(16)
        self.year_label.setFont(font)
        self.year_label.setObjectName("year_label")
        self.harness_counter_entry = QtWidgets.QLineEdit(self.centralwidget)
        self.harness_counter_entry.setGeometry(QtCore.QRect(720, 410, 151, 41))
        font = QtGui.QFont()
        font.setFamily("Source Sans Pro Light")
        font.setPointSize(16)
        self.harness_counter_entry.setFont(font)
        self.harness_counter_entry.setFocusPolicy(QtCore.Qt.ClickFocus)
        self.harness_counter_entry.setAlignment(QtCore.Qt.AlignCenter)
        self.harness_counter_entry.setObjectName("harness_counter_entry")
        self.revision_entry = QtWidgets.QLineEdit(self.centralwidget)
        self.revision_entry.setGeometry(QtCore.QRect(720, 250, 151, 41))
        font = QtGui.QFont()
        font.setFamily("Source Sans Pro Light")
        font.setPointSize(16)
        self.revision_entry.setFont(font)
        self.revision_entry.setFocusPolicy(QtCore.Qt.ClickFocus)
        self.revision_entry.setAlignment(QtCore.Qt.AlignCenter)
        self.revision_entry.setObjectName("revision_entry")
        self.order_entry = QtWidgets.QLineEdit(self.centralwidget)
        self.order_entry.setGeometry(QtCore.QRect(720, 330, 151, 41))
        font = QtGui.QFont()
        font.setFamily("Source Sans Pro Light")
        font.setPointSize(16)
        self.order_entry.setFont(font)
        self.order_entry.setFocusPolicy(QtCore.Qt.ClickFocus)
        self.order_entry.setText("")
        self.order_entry.setAlignment(QtCore.Qt.AlignCenter)
        self.order_entry.setObjectName("order_entry")
        self.revision_label = QtWidgets.QLabel(self.centralwidget)
        self.revision_label.setGeometry(QtCore.QRect(550, 250, 171, 41))
        font = QtGui.QFont()
        font.setFamily("Source Sans Pro Light")
        font.setPointSize(16)
        self.revision_label.setFont(font)
        self.revision_label.setObjectName("revision_label")
        self.which_harness_label = QtWidgets.QLabel(self.centralwidget)
        self.which_harness_label.setGeometry(QtCore.QRect(550, 410, 171, 41))
        font = QtGui.QFont()
        font.setFamily("Source Sans Pro Light")
        font.setPointSize(16)
        self.which_harness_label.setFont(font)
        self.which_harness_label.setObjectName("which_harness_label")
        self.order_label = QtWidgets.QLabel(self.centralwidget)
        self.order_label.setGeometry(QtCore.QRect(550, 330, 171, 41))
        font = QtGui.QFont()
        font.setFamily("Source Sans Pro Light")
        font.setPointSize(16)
        self.order_label.setFont(font)
        self.order_label.setObjectName("order_label")
        self.magic_label_button = QtWidgets.QPushButton(self.centralwidget)
        self.magic_label_button.setGeometry(QtCore.QRect(630, 560, 151, 51))
        self.magic_label_button.setObjectName("magic_label_button")
        kramer_ewelon_window.setCentralWidget(self.centralwidget)

        self.retranslateUi(kramer_ewelon_window)
        QtCore.QMetaObject.connectSlotsByName(kramer_ewelon_window)

        # my code outside qt designer
        self.generate_button.clicked.connect(self.generate)
        self.magic_label_button.clicked.connect(self.magic_label_move)

    def retranslateUi(self, cps_generator_window):
        _translate = QtCore.QCoreApplication.translate
        cps_generator_window.setWindowTitle(_translate("cps_generator_window", "ECI Toolbox v2.00"))
        self.welcome_label.setText(_translate("cps_generator_window", "Ewelinowe QRki :)"))
        self.generate_button.setText(_translate("cps_generator_window", "Generuj"))
        self.day_label.setText(_translate("cps_generator_window", "Dzień:"))
        self.month_label.setText(_translate("cps_generator_window", "Miesiąc:"))
        self.harness_id_label.setText(_translate("cps_generator_window", "Numer wiązki:"))
        self.year_label.setText(_translate("cps_generator_window", "Rok:"))
        self.revision_label.setText(_translate("cps_generator_window", "Rewizja:"))
        self.which_harness_label.setText(_translate("cps_generator_window", "Która wiązka?"))
        self.order_label.setText(_translate("cps_generator_window", "Zlecenie:"))
        self.magic_label_button.setText(_translate("cps_generator_window", "Magiczna etykieta"))


    def clean(self):
        self.day_entry.clear()
        self.month_entry.clear()
        self.year_entry.clear()
        self.revision_entry.clear()
        self.order_entry.clear()
        self.harness_id_entry.clear()
        self.harness_counter_entry.clear()


    def generate(self):
        with open("templates\\Kramer Ewelon.nxf") as f:
            input_file = f.read()
        with open("Ewelina.nxf", "w", encoding="utf-8") as wf:
            wf.write(Template(input_file).safe_substitute
                     (day=self.day_entry.text(), month=self.month_entry.text(), year=self.year_entry.text(),
                      revision=self.revision_entry.text(), order=self.order_entry.text(),
                      harness_id=self.harness_id_entry.text(), harness_counter=self.harness_counter_entry.text()))
        if os.path.isfile(desktop_path + "Ewelina.nxf"):
            question = ctypes.windll.user32.MessageBoxW(0, "Plik \"Ewelina.nxf\" istnieje."
                                                           " Podmienić?", "Wystąpił błąd", 4)
            if question == 6:
                os.remove(desktop_path + "Ewelina.nxf")
                shutil.move(os.getcwd() +"\\Ewelina.nxf", desktop_path)
                self.clean()
                return
            elif question == 7:
                return

        shutil.move(os.getcwd() + "\\Ewelina.nxf", desktop_path)
        self.clean()


    def magic_label_move(self):
        shutil.copy("templates\\Magiczna_Etykieta.prn", desktop_path)
        ctypes.windll.user32.MessageBoxW(0, f'Etykieta znajduje się na pulpicie, idź do chłopaków '
                                            f'z klatki żeby Ci ją wydrukowali :)', "Informacja", 0x40)

if __name__ == "__main__":
    import sys
    app = QtWidgets.QApplication(sys.argv)
    MainWindow = QtWidgets.QMainWindow()
    ui = Ui_kramer_ewelon_window()
    ui.setupUi(MainWindow)
    MainWindow.show()
    sys.exit(app.exec_())
